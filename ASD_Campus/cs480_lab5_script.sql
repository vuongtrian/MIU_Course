-- MySQL Script generated by MySQL Workbench
-- Sun Apr  7 13:13:16 2024
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;

-- -----------------------------------------------------
-- Table `mydb`.`Patient`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Patient` (
  `id` VARCHAR(4) NOT NULL,
  `firstName` VARCHAR(45) NULL,
  `lastName` VARCHAR(45) NULL,
  `phoneNumber` VARCHAR(45) NOT NULL,
  `email` VARCHAR(45) NOT NULL,
  `DOB` DATETIME NULL,
  `Address` VARCHAR(200) NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Dentist`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Dentist` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `firstName` VARCHAR(45) NOT NULL,
  `lastName` VARCHAR(45) NOT NULL,
  `phoneNumber` VARCHAR(45) NOT NULL,
  `email` VARCHAR(45) NULL,
  `specialization` VARCHAR(45) NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Surgery`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Surgery` (
  `id` VARCHAR(3) NOT NULL,
  `name` VARCHAR(45) NULL,
  `location` VARCHAR(45) NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Appointment`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Appointment` (
  `id` INT NOT NULL,
  `dateTime` DATETIME NULL,
  `Patient_id` VARCHAR(4) NOT NULL,
  `Dentist_id` INT NOT NULL,
  `Surgery_id` VARCHAR(3) NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `fk_Appointment_Patient1_idx` (`Patient_id` ASC) VISIBLE,
  INDEX `fk_Appointment_Dentist1_idx` (`Dentist_id` ASC) VISIBLE,
  INDEX `fk_Appointment_Surgery1_idx` (`Surgery_id` ASC) VISIBLE,
  CONSTRAINT `fk_Appointment_Patient1`
    FOREIGN KEY (`Patient_id`)
    REFERENCES `mydb`.`Patient` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Appointment_Dentist1`
    FOREIGN KEY (`Dentist_id`)
    REFERENCES `mydb`.`Dentist` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Appointment_Surgery1`
    FOREIGN KEY (`Surgery_id`)
    REFERENCES `mydb`.`Surgery` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

INSERT INTO Dentist (firstName, lastName, phoneNumber, email, specialization) VALUES
('Tony', 'Smith', '5551234567', 'tony.smith@cs489.miu.edu', 'Orthodontics'),
('Helen', 'Pearson', '5559876543', 'helen.pearson@cs489.miu.edu', 'Pediatric Dentistry'),
('Robin', 'Plevin', '5559457281', 'robin.plevin@cs489.miu.edu', 'Pediatric Dentistry');

INSERT INTO Patient (id, firstName, lastName, phoneNumber, email, DOB, Address) VALUES
('P100', 'Gillian', 'White', '1234567890', 'gillian.white@cs489.miu.edu', '1980-05-15', '123 Main St, Fairfield, Iowa'),
('P105', 'Jill', 'Bell', '9876543210', 'jill.bell@cs489.miu.edu', '1992-08-20', '456 Elm St, Ottomwa, Iowa'),
('P108', 'Ian', 'MacKey', '5716543516', 'ian.mackey@cs489.miu.edu', '1995-03-25', '456 Burlington St, Fairfield, Iowa'),
('P110', 'John', 'Walker', '8326543885', 'john.walker@cs489.miu.edu', '1987-05-18', '456 Saint St, Ames, Iowa');

INSERT INTO Surgery (id, name, location) VALUES
('S15', 'Tooth Extraction', 'Dental Clinic A'),
('S10', 'Dental Cleaning', 'Dental Clinic B'),
('S13', 'Dental Checking', 'Dental Clinic C');

INSERT INTO Appointment (id, dateTime, Patient_id, Dentist_id, Surgery_id) VALUES
(1, '2022-03-10 09:00:00', 'P100', 1, 'S15'),
(2, '2022-03-10 10:30:00', 'P105', 1, 'S15'),
(3, '2022-03-10 08:15:00', 'P108', 2, 'S10'),
(4, '2022-03-11 09:15:00', 'P108', 2, 'S10'),
(5, '2022-03-10 09:15:00', 'P105', 3, 'S15'),
(6, '2022-03-11 11:30:00', 'P110', 3, 'S13');

SELECT * FROM Dentist ORDER BY lastName ASC;

SELECT A.*, P.*
FROM Appointment A
JOIN Patient P ON A.Patient_id = P.id
WHERE A.Dentist_id = 2;

SELECT * FROM Appointment A
JOIN Surgery S ON S.id = A.Surgery_id
WHERE S.location = 'Dental Clinic B';

SELECT * FROM Appointment 
WHERE Patient_id = 'P108' AND dateTime = '2022-03-11 09:15:00';
